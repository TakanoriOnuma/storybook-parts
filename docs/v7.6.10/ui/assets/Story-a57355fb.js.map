{"version":3,"file":"Story-a57355fb.js","sources":["../../ui/blocks/src/blocks/Story.tsx"],"sourcesContent":["import type { FC, ComponentProps } from 'react';\nimport React, { useContext } from 'react';\nimport type {\n  Renderer,\n  ModuleExport,\n  ModuleExports,\n  PreparedStory,\n  StoryAnnotations,\n  StoryId,\n} from '@storybook/types';\nimport { deprecate } from '@storybook/client-logger';\n\nimport dedent from 'ts-dedent';\nimport { Story as PureStory, StorySkeleton } from '../components';\nimport type { DocsContextProps } from './DocsContext';\nimport { DocsContext } from './DocsContext';\nimport { useStory } from './useStory';\n\ntype PureStoryProps = ComponentProps<typeof PureStory>;\n\n/**\n * Props to define a story\n *\n * @deprecated Define stories in CSF files\n */\ntype StoryDefProps = StoryAnnotations;\n\n/**\n * Props to reference another story\n */\ntype StoryRefProps = {\n  /**\n   * @deprecated Use of={storyExport} instead\n   */\n  id?: string;\n  /**\n   * @deprecated Use of={storyExport} and define the story in the CSF file\n   */\n  story?: StoryAnnotations;\n  /**\n   * Pass the export defining a story to render that story\n   *\n   * ```jsx\n   * import { Meta, Story } from '@storybook/blocks';\n   * import * as ButtonStories from './Button.stories';\n   *\n   * <Meta of={ButtonStories} />\n   * <Story of={ButtonStories.Primary} />\n   * ```\n   */\n  of?: ModuleExport;\n  /**\n   * Pass all exports of the CSF file if this MDX file is unattached\n   *\n   * ```jsx\n   * import { Story } from '@storybook/blocks';\n   * import * as ButtonStories from './Button.stories';\n   *\n   * <Story of={ButtonStories.Primary} meta={ButtonStories} />\n   * ```\n   */\n  meta?: ModuleExports;\n};\n\ntype StoryParameters = {\n  /**\n   * Render the story inline or in an iframe\n   */\n  inline?: boolean;\n  /**\n   * When rendering in an iframe (`inline={false}`), set the story height\n   */\n  height?: string;\n  /**\n   * Whether to run the story's play function\n   */\n  autoplay?: boolean;\n  /**\n   * Internal prop to control if a story re-renders on args updates\n   */\n  __forceInitialArgs?: boolean;\n  /**\n   * Internal prop if this story is the primary story\n   */\n  __primary?: boolean;\n};\n\nexport type StoryProps = (StoryDefProps | StoryRefProps) & StoryParameters;\n\nexport const getStoryId = (props: StoryProps, context: DocsContextProps): StoryId => {\n  const { id, of, meta, story } = props as StoryRefProps;\n  if ('of' in props && of === undefined) {\n    throw new Error('Unexpected `of={undefined}`, did you mistype a CSF file reference?');\n  }\n\n  if (id) {\n    deprecate(dedent`Referencing stories by \\`id\\` is deprecated, please use \\`of\\` instead. \n    \n      Please refer to the migration guide: https://github.com/storybookjs/storybook/blob/next/MIGRATION.md#story-block'`);\n    return id;\n  }\n\n  const { name } = props as StoryDefProps;\n  if (name) {\n    deprecate(dedent`Referencing stories by \\`name\\` is deprecated, please use \\`of\\` instead. \n    \n      Please refer to the migration guide: https://github.com/storybookjs/storybook/blob/next/MIGRATION.md#story-block'`);\n    return context.storyIdByName(name);\n  }\n\n  // The `story={moduleExports}` prop is a legacy prop for stories defined in CSF files, but\n  // \"declared\" in MDX files (the CSF file has no meta export or doesn't match the stories glob).\n  // In this case, the `.stories.mdx` file will have actually ended up declaring the story\n  // so we can reference the story just the same as an `of={moduleExports}` would have.\n  // See https://github.com/storybookjs/mdx2-csf/issues/3\n  if (story) {\n    deprecate(dedent`The \\`story\\` prop is deprecated, please export your stories from CSF files and reference them with \\`of={}\\`.\n\n      Please refer to the migration guide: https://github.com/storybookjs/storybook/blob/next/MIGRATION.md#story-block'`);\n  }\n\n  if (meta) context.referenceMeta(meta, false);\n  const resolved = context.resolveOf(of || story || 'story', ['story']);\n  return resolved.story.id;\n};\n\nexport const getStoryProps = <TFramework extends Renderer>(\n  props: StoryParameters,\n  story: PreparedStory<TFramework>,\n  context: DocsContextProps<TFramework>\n): PureStoryProps => {\n  const { parameters = {} } = story || {};\n  const { docs = {} } = parameters;\n  const storyParameters = (docs.story || {}) as StoryParameters & { iframeHeight?: string };\n\n  if (docs.disable) {\n    return null;\n  }\n\n  // prefer block props, then story parameters defined by the framework-specific settings\n  // and optionally overridden by users\n\n  // Deprecated parameters\n  const { inlineStories, iframeHeight } = docs as {\n    inlineStories?: boolean;\n    iframeHeight?: string;\n    autoplay?: boolean;\n  };\n  if (typeof inlineStories !== 'undefined')\n    deprecate(dedent`The \\`docs.inlineStories\\` parameter is deprecated, use \\`docs.story.inline\\` instead. \n    \n      Please refer to the migration guide: https://github.com/storybookjs/storybook/blob/next/MIGRATION.md#autodocs-changes'\n    `);\n  const inline = props.inline ?? storyParameters.inline ?? inlineStories ?? false;\n\n  if (typeof iframeHeight !== 'undefined') {\n    deprecate(dedent`The \\`docs.iframeHeight\\` parameter is deprecated, use \\`docs.story.iframeHeight\\` instead. \n    \n      Please refer to the migration guide: https://github.com/storybookjs/storybook/blob/next/MIGRATION.md#autodocs-changes'\n    `);\n  }\n\n  if (inline) {\n    const height = props.height ?? storyParameters.height;\n    const autoplay = props.autoplay ?? storyParameters.autoplay ?? false;\n    return {\n      story,\n      inline: true,\n      height,\n      autoplay,\n      // eslint-disable-next-line no-underscore-dangle\n      forceInitialArgs: !!props.__forceInitialArgs,\n      // eslint-disable-next-line no-underscore-dangle\n      primary: !!props.__primary,\n      renderStoryToElement: context.renderStoryToElement,\n    };\n  }\n\n  const height =\n    props.height ??\n    storyParameters.height ??\n    storyParameters.iframeHeight ??\n    iframeHeight ??\n    '100px';\n  return {\n    story,\n    inline: false,\n    height,\n    // eslint-disable-next-line no-underscore-dangle\n    primary: !!props.__primary,\n  };\n};\n\nconst Story: FC<StoryProps> = (props = { __forceInitialArgs: false, __primary: false }) => {\n  const context = useContext(DocsContext);\n  const storyId = getStoryId(props, context);\n  const story = useStory(storyId, context);\n\n  if (!story) {\n    return <StorySkeleton />;\n  }\n\n  const storyProps = getStoryProps(props, story, context);\n  if (!storyProps) {\n    return null;\n  }\n\n  return <PureStory {...storyProps} />;\n};\n\nexport { Story };\n"],"names":["deprecate","getStoryId","props","context","id","of","meta","story","dedent","name","getStoryProps","parameters","docs","storyParameters","inlineStories","iframeHeight","inline","height2","autoplay","height","Story","useContext","DocsContext","storyId","useStory","jsx","StorySkeleton","storyProps","PureStory"],"mappings":"sQAUA,KAAA,CAAA,UAAAA,CAAA,EAAA,mCA+EOC,EAAA,CAAAC,EAAAC,IAAA,CACL,KAAA,CAAA,GAAAC,EAAA,GAAAC,EAAA,KAAAC,EAAA,MAAAC,CAAA,EAAAL,EACA,GAAA,OAAAA,GAAAG,IAAA,OACE,MAAA,IAAA,MAAA,oEAAA,EAGF,GAAAD,EACE,OAAAJ,EAAAQ;AAAA;AAAA,wHAAU,EAGVJ,EAGF,KAAA,CAAA,KAAAK,CAAA,EAAAP,EACA,OAAAO,GACET,EAAAQ;AAAA;AAAA,wHAAU,EAGVL,EAAA,cAAAM,CAAA,IAQFF,GACEP,EAAAQ;AAAA;AAAA,wHAAU,EAKZF,GAAUH,EAAA,cAAAG,EAAA,EAAA,EACVH,EAAA,UAAAE,GAAAE,GAAA,QAAA,CAAA,OAAA,CAAA,EACA,MAAA,GACF,EAEOG,EAAA,CAAAR,EAAAK,EAAAJ,IAAA,CAKL,KAAA,CAAA,WAAAQ,EAAA,CAAA,GAAAJ,GAAA,CAAA,EACA,CAAA,KAAAK,EAAA,EAAA,EAAAD,EACAE,EAAAD,EAAA,OAAA,GAEA,GAAAA,EAAA,QACE,OAAA,KAOF,KAAA,CAAA,cAAAE,EAAA,aAAAC,CAAA,EAAAH,EAKA,OAAAE,EAAA,KACEd,EAAAQ;AAAA;AAAA;AAAA,KAAU,EAIZ,MAAAQ,EAAAd,EAAA,QAAAW,EAAA,QAAAC,GAAA,GASA,GAPA,OAAAC,EAAA,KACEf,EAAAQ;AAAA;AAAA;AAAA,KAAU,EAMZQ,EAAA,CACE,MAAAC,EAAAf,EAAA,QAAAW,EAAA,OACAK,EAAAhB,EAAA,UAAAW,EAAA,UAAA,GACA,MAAA,CAAO,MAAAN,EACL,OAAA,GACQ,OAAAU,EACR,SAAAC,EACA,iBAAA,CAAA,CAAAhB,EAAA,mBAE0B,QAAA,CAAA,CAAAA,EAAA,UAET,qBAAAC,EAAA,oBACa,CAChC,CAGF,MAAAgB,EAAAjB,EAAA,QAAAW,EAAA,QAAAA,EAAA,cAAAE,GAAA,QAMA,MAAA,CAAO,MAAAR,EACL,OAAA,GACQ,OAAAY,EACR,QAAA,CAAA,CAAAjB,EAAA,SAEiB,CAErB,EAEAkB,EAAA,CAAAlB,EAAA,CAAA,mBAAA,GAAA,UAAA,MAAA,CACE,MAAAC,EAAAkB,aAAAC,CAAA,EACAC,EAAAtB,EAAAC,EAAAC,CAAA,EACAI,EAAAiB,EAAAD,EAAApB,CAAA,EAEA,GAAA,CAAAI,EACE,OAAAkB,EAAAC,EAAA,CAAA,CAAA,EAGF,MAAAC,EAAAjB,EAAAR,EAAAK,EAAAJ,CAAA,EACA,OAAAwB,EAIAF,EAAAG,EAAA,CAAA,GAAAD,CAAA,CAAA,EAHE,IAIJ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}