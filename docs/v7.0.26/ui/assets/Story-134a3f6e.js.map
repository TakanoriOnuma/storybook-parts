{"version":3,"file":"Story-134a3f6e.js","sources":["../../ui/blocks/src/components/ZoomContext.tsx","../../ui/blocks/src/components/IFrame.tsx","../../ui/blocks/src/components/Story.tsx"],"sourcesContent":["import type { Context } from 'react';\nimport { createContext } from 'react';\n\nexport const ZoomContext: Context<{ scale: number }> = createContext({\n  scale: 1,\n});\n","import React, { Component } from 'react';\nimport { global } from '@storybook/global';\n\nconst { window: globalWindow } = global;\n\ninterface IFrameProps {\n  id: string;\n  key?: string;\n  title: string;\n  src: string;\n  allowFullScreen: boolean;\n  scale: number;\n  style?: any;\n}\n\ninterface BodyStyle {\n  width: string;\n  height: string;\n  transform: string;\n  transformOrigin: string;\n}\n\nexport class IFrame extends Component<IFrameProps> {\n  iframe: any = null;\n\n  componentDidMount() {\n    const { id } = this.props;\n    this.iframe = globalWindow.document.getElementById(id);\n  }\n\n  shouldComponentUpdate(nextProps: IFrameProps) {\n    const { scale } = nextProps;\n    // eslint-disable-next-line react/destructuring-assignment\n    if (scale !== this.props.scale) {\n      this.setIframeBodyStyle({\n        width: `${scale * 100}%`,\n        height: `${scale * 100}%`,\n        transform: `scale(${1 / scale})`,\n        transformOrigin: 'top left',\n      });\n    }\n    return false;\n  }\n\n  setIframeBodyStyle(style: BodyStyle) {\n    return Object.assign(this.iframe.contentDocument.body.style, style);\n  }\n\n  render() {\n    const { id, title, src, allowFullScreen, scale, ...rest } = this.props;\n    return (\n      <iframe\n        id={id}\n        title={title}\n        src={src}\n        {...(allowFullScreen ? { allow: 'fullscreen' } : {})}\n        loading=\"lazy\"\n        {...rest}\n      />\n    );\n  }\n}\n","import { global } from '@storybook/global';\nimport type { FunctionComponent } from 'react';\nimport React, { useRef, useEffect, useState } from 'react';\nimport type { DocsContextProps, PreparedStory } from '@storybook/types';\nimport { Loader, getStoryHref, ErrorFormatter } from '@storybook/components';\nimport { IFrame } from './IFrame';\nimport { ZoomContext } from './ZoomContext';\n\nconst { PREVIEW_URL } = global;\nconst BASE_URL = PREVIEW_URL || 'iframe.html';\n\ninterface CommonProps {\n  story: PreparedStory;\n  inline: boolean;\n  primary: boolean;\n}\n\ninterface InlineStoryProps extends CommonProps {\n  inline: true;\n  height?: string;\n  autoplay: boolean;\n  forceInitialArgs: boolean;\n  renderStoryToElement: DocsContextProps['renderStoryToElement'];\n}\n\ninterface IFrameStoryProps extends CommonProps {\n  inline: false;\n  height: string;\n}\n\nexport type StoryProps = InlineStoryProps | IFrameStoryProps;\n\nexport const storyBlockIdFromId = ({ story, primary }: StoryProps) =>\n  `story--${story.id}${primary ? '--primary' : ''}`;\n\nconst InlineStory: FunctionComponent<InlineStoryProps> = (props) => {\n  const storyRef = useRef();\n  const [showLoader, setShowLoader] = useState(true);\n  const [error, setError] = useState<Error>();\n\n  const { story, height, autoplay, forceInitialArgs, renderStoryToElement } = props;\n\n  useEffect(() => {\n    if (!(story && storyRef.current)) {\n      return () => {};\n    }\n    const element = storyRef.current as HTMLElement;\n    const cleanup = renderStoryToElement(\n      story,\n      element,\n      {\n        showMain: () => {},\n        showError: ({ title, description }: { title: string; description: string }) =>\n          setError(new Error(`${title} - ${description}`)),\n        showException: (err: Error) => setError(err),\n      },\n      { autoplay, forceInitialArgs }\n    );\n    setShowLoader(false);\n    return () => {\n      // It seems like you are supposed to unmount components outside of `useEffect`:\n      //   https://github.com/facebook/react/issues/25675#issuecomment-1363957941\n      Promise.resolve().then(() => cleanup());\n    };\n  }, [autoplay, renderStoryToElement, story]);\n\n  // We do this so React doesn't complain when we replace the span in a secondary render\n  const htmlContents = `<span></span>`;\n\n  if (error) {\n    return (\n      <pre>\n        <ErrorFormatter error={error} />\n      </pre>\n    );\n  }\n\n  return (\n    <>\n      {height ? (\n        <style>{`#${storyBlockIdFromId(\n          props\n        )} { min-height: ${height}; transform: translateZ(0); overflow: auto }`}</style>\n      ) : null}\n      {showLoader && <StorySkeleton />}\n      <div\n        ref={storyRef}\n        id={`${storyBlockIdFromId(props)}-inner`}\n        data-name={story.name}\n        // eslint-disable-next-line react/no-danger\n        dangerouslySetInnerHTML={{ __html: htmlContents }}\n      />\n    </>\n  );\n};\n\nconst IFrameStory: FunctionComponent<IFrameStoryProps> = ({ story, height = '500px' }) => (\n  <div style={{ width: '100%', height }}>\n    <ZoomContext.Consumer>\n      {({ scale }) => {\n        return (\n          <IFrame\n            key=\"iframe\"\n            id={`iframe--${story.id}`}\n            title={story.name}\n            src={getStoryHref(BASE_URL, story.id, { viewMode: 'story' })}\n            allowFullScreen\n            scale={scale}\n            style={{\n              width: '100%',\n              height: '100%',\n              border: '0 none',\n            }}\n          />\n        );\n      }}\n    </ZoomContext.Consumer>\n  </div>\n);\n\n/**\n * A story element, either rendered inline or in an iframe,\n * with configurable height.\n */\nconst Story: FunctionComponent<StoryProps> = (props) => {\n  const { inline } = props;\n\n  return (\n    <div id={storyBlockIdFromId(props)} className=\"sb-story sb-unstyled\" data-story-block=\"true\">\n      {inline ? (\n        <InlineStory {...(props as InlineStoryProps)} />\n      ) : (\n        <IFrameStory {...(props as IFrameStoryProps)} />\n      )}\n    </div>\n  );\n};\n\nconst StorySkeleton = () => <Loader />;\n\nexport { Story, StorySkeleton };\n"],"names":["ZoomContext","createContext","globalWindow","global","IFrame","Component","id","nextProps","scale","style","title","src","allowFullScreen","rest","jsx","PREVIEW_URL","BASE_URL","storyBlockIdFromId","story","primary","InlineStory","props","storyRef","useRef","showLoader","setShowLoader","useState","error","setError","height","autoplay","forceInitialArgs","renderStoryToElement","useEffect","element","cleanup","description","err","htmlContents","ErrorFormatter","jsxs","Fragment","StorySkeleton","IFrameStory","getStoryHref","Story","inline","Loader"],"mappings":"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"}