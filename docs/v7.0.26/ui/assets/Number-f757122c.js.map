{"version":3,"file":"Number-f757122c.js","sources":["../../ui/blocks/src/controls/Number.tsx"],"sourcesContent":["import type { FC, ChangeEvent } from 'react';\nimport React, { useState, useCallback, useEffect, useRef } from 'react';\nimport { styled } from '@storybook/theming';\nimport { Form } from '@storybook/components';\nimport { getControlId, getControlSetterButtonId } from './helpers';\n\nimport type { ControlProps, NumberValue, NumberConfig } from './types';\n\nconst Wrapper = styled.label({\n  display: 'flex',\n});\n\ntype NumberProps = ControlProps<NumberValue | null> & NumberConfig;\n\nexport const parse = (value: string) => {\n  const result = parseFloat(value);\n  return Number.isNaN(result) ? undefined : result;\n};\n\nexport const format = (value: NumberValue) => (value != null ? String(value) : '');\n\nexport const NumberControl: FC<NumberProps> = ({\n  name,\n  value,\n  onChange,\n  min,\n  max,\n  step,\n  onBlur,\n  onFocus,\n}) => {\n  const [inputValue, setInputValue] = useState(typeof value === 'number' ? value : '');\n  const [forceVisible, setForceVisible] = useState(false);\n  const [parseError, setParseError] = useState<Error>(null);\n\n  const handleChange = useCallback(\n    (event: ChangeEvent<HTMLInputElement>) => {\n      setInputValue(event.target.value);\n\n      const result = parseFloat(event.target.value);\n      if (Number.isNaN(result)) {\n        setParseError(new Error(`'${event.target.value}' is not a number`));\n      } else {\n        onChange(result);\n        setParseError(null);\n      }\n    },\n    [onChange, setParseError]\n  );\n\n  const onForceVisible = useCallback(() => {\n    setInputValue('0');\n    onChange(0);\n    setForceVisible(true);\n  }, [setForceVisible]);\n\n  const htmlElRef = useRef(null);\n  useEffect(() => {\n    if (forceVisible && htmlElRef.current) htmlElRef.current.select();\n  }, [forceVisible]);\n\n  useEffect(() => {\n    const newInputValue = typeof value === 'number' ? value : '';\n    if (inputValue !== newInputValue) {\n      setInputValue(value);\n    }\n  }, [value]);\n\n  if (!forceVisible && value === undefined) {\n    return (\n      <Form.Button id={getControlSetterButtonId(name)} onClick={onForceVisible}>\n        Set number\n      </Form.Button>\n    );\n  }\n\n  return (\n    <Wrapper>\n      <Form.Input\n        ref={htmlElRef}\n        id={getControlId(name)}\n        type=\"number\"\n        onChange={handleChange}\n        size=\"flex\"\n        placeholder=\"Edit number...\"\n        value={inputValue}\n        valid={parseError ? 'error' : null}\n        autoFocus={forceVisible}\n        {...{ name, min, max, step, onFocus, onBlur }}\n      />\n    </Wrapper>\n  );\n};\n"],"names":["Wrapper","styled","parse","value","result","format","NumberControl","name","onChange","min","max","step","onBlur","onFocus","inputValue","setInputValue","useState","forceVisible","setForceVisible","parseError","setParseError","handleChange","useCallback","event","onForceVisible","htmlElRef","useRef","useEffect","jsx","Form","getControlSetterButtonId","getControlId"],"mappings":"uNAQA,MAAAA,EAAAC,EAAA,MAAA,CAA6B,QAAA,MAE7B,CAAA,EAIOC,EAAAC,GAAA,CACL,MAAAC,EAAA,WAAAD,CAAA,EACA,OAAA,OAAA,MAAAC,CAAA,EAAA,OAAAA,CACF,EAEOC,EAAAF,GAAAA,GAAA,KAAA,OAAAA,CAAA,EAAA,GAEAG,EAAA,CAAA,CAAwC,KAAAC,EAC7C,MAAAJ,EACA,SAAAK,EACA,IAAAC,EACA,IAAAC,EACA,KAAAC,EACA,OAAAC,EACA,QAAAC,CAEF,IAAA,CACE,KAAA,CAAAC,EAAAC,CAAA,EAAAC,EAAA,SAAA,OAAAb,GAAA,SAAAA,EAAA,EAAA,EACA,CAAAc,EAAAC,CAAA,EAAAF,EAAA,SAAA,EAAA,EACA,CAAAG,EAAAC,CAAA,EAAAJ,EAAA,SAAA,IAAA,EAEAK,EAAAC,EAAA,YAAqBC,GAAA,CAEjBR,EAAAQ,EAAA,OAAA,KAAA,EAEA,MAAAnB,EAAA,WAAAmB,EAAA,OAAA,KAAA,EACA,OAAA,MAAAnB,CAAA,EACEgB,EAAA,IAAA,MAAA,IAAAG,EAAA,OAAA,wBAAA,CAAA,GAEAf,EAAAJ,CAAA,EACAgB,EAAA,IAAA,EACF,EACF,CAAAZ,EAAAY,CAAA,CACwB,EAG1BI,EAAAF,EAAAA,YAAA,IAAA,CACEP,EAAA,GAAA,EACAP,EAAA,CAAA,EACAU,EAAA,EAAA,CAAoB,EAAA,CAAAA,CAAA,CAAA,EAGtBO,EAAAC,SAAA,IAAA,EAYA,OAXAC,EAAAA,UAAA,IAAA,CACEV,GAAAQ,EAAA,SAAuCA,EAAA,QAAA,QAAyB,EAAA,CAAAR,CAAA,CAAA,EAGlEU,EAAAA,UAAA,IAAA,CAEEb,KADA,OAAAX,GAAA,SAAAA,EAAA,KAEEY,EAAAZ,CAAA,CACF,EAAA,CAAAA,CAAA,CAAA,EAGF,CAAAc,GAAAd,IAAA,OACEyB,EAAAC,EAAA,OAAA,CAAA,GAAAC,EAAAvB,CAAA,EAAA,QAAAiB,EAAA,SAAA,YAAA,CAAA,EAOFI,EAAA5B,EAAA,CAAA,SAAA4B,EAEIC,EAAA,MAAM,CAAL,IAAAJ,EACM,GAAAM,EAAAxB,CAAA,EACgB,KAAA,SAChB,SAAAc,EACK,KAAA,OACL,YAAA,iBACO,MAAAP,EACL,MAAAK,EAAA,QAAA,KACuB,UAAAF,EACnB,KAAAV,EAAA,IAAAE,EAAA,IAAAC,EAAA,KAAAC,EAAA,QAAAE,EAAA,OAAAD,CACiC,CAAA,CAAA,CAAA,CAIpD"}