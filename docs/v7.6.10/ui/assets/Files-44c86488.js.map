{"version":3,"file":"Files-44c86488.js","sources":["../../ui/blocks/src/controls/Files.tsx"],"sourcesContent":["import React, { useEffect, useRef } from 'react';\nimport type { ChangeEvent, FC } from 'react';\nimport { styled } from '@storybook/theming';\nimport { Form } from '@storybook/components';\n\nimport type { ControlProps } from './types';\nimport { getControlId } from './helpers';\n\nexport interface FilesControlProps extends ControlProps<string[]> {\n  /**\n   * The accept attribute value is a string that defines the file types the file input should accept. This string is a comma-separated list of unique file type specifiers.\n   * @example\n   * *\\/*\n   * @example\n   * .webm,video/webm\n   * @example\n   * .doc,.docx,application/msword\n   * @defaultValue `image/*`\n   * @see https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/file#accept\n   */\n  accept?: string;\n}\n\nconst FileInput = styled(Form.Input)({\n  padding: 10,\n});\n\nfunction revokeOldUrls(urls: string[]) {\n  urls.forEach((url) => {\n    if (url.startsWith('blob:')) {\n      URL.revokeObjectURL(url);\n    }\n  });\n}\n\nexport const FilesControl: FC<FilesControlProps> = ({\n  onChange,\n  name,\n  accept = 'image/*',\n  value,\n}) => {\n  const inputElement = useRef<HTMLInputElement>(null);\n\n  function handleFileChange(e: ChangeEvent<HTMLInputElement>) {\n    if (!e.target.files) {\n      return;\n    }\n    const fileUrls = Array.from(e.target.files).map((file) => URL.createObjectURL(file));\n    onChange(fileUrls);\n    revokeOldUrls(value);\n  }\n\n  // Added useEffect hook to reset the file value when value is null\n  useEffect(() => {\n    if (value == null && inputElement.current) {\n      inputElement.current.value = null;\n    }\n  }, [value, name]);\n\n  return (\n    <FileInput\n      ref={inputElement}\n      id={getControlId(name)}\n      type=\"file\"\n      name={name}\n      multiple\n      onChange={handleFileChange}\n      accept={accept}\n      size=\"flex\"\n    />\n  );\n};\n"],"names":["FileInput","styled","Form","revokeOldUrls","urls","url","FilesControl","onChange","name","accept","value","inputElement","useRef","handleFileChange","e","fileUrls","file","useEffect","jsx","getControlId"],"mappings":"gNAuBA,MAAAA,EAAAC,EAAAC,EAAA,KAAA,EAAA,CAAqC,QAAA,EAErC,CAAA,EAEA,SAAAC,EAAAC,EAAA,CACEA,EAAA,QAAAC,GAAA,CACEA,EAAA,WAAA,OAAA,GACE,IAAA,gBAAAA,CAAA,CACF,CAAA,CAEJ,CAEO,MAAAC,EAAA,CAAA,CAA6C,SAAAC,EAClD,KAAAC,EACA,OAAAC,EAAA,UACS,MAAAC,CAEX,IAAA,CACE,MAAAC,EAAAC,SAAA,IAAA,EAEA,SAAAC,EAAAC,EAAA,CACE,GAAA,CAAAA,EAAA,OAAA,MACE,OAEF,MAAAC,EAAA,MAAA,KAAAD,EAAA,OAAA,KAAA,EAAA,IAAAE,GAAA,IAAA,gBAAAA,CAAA,CAAA,EACAT,EAAAQ,CAAA,EACAZ,EAAAO,CAAA,CAAmB,CAIrBO,OAAAA,EAAAA,UAAA,IAAA,CACEP,GAAA,MAAAC,EAAA,UACEA,EAAA,QAAA,MAAA,KACF,EAAA,CAAAD,EAAAF,CAAA,CAAA,EAGFU,EACElB,EAAC,CAAA,IAAAW,EACM,GAAAQ,EAAAX,CAAA,EACgB,KAAA,OAChB,KAAAA,EACL,SAAA,GACQ,SAAAK,EACE,OAAAJ,EACV,KAAA,MACK,CAAA,CAGX;;;;;"}