{"version":3,"file":"Controls-9aafa0f6.js","sources":["../../ui/blocks/src/blocks/useGlobals.ts","../../ui/blocks/src/blocks/useArgs.ts","../../ui/blocks/src/blocks/Controls.tsx"],"sourcesContent":["import type { Globals } from '@storybook/csf';\nimport type { DocsContextProps, PreparedStory } from '@storybook/types';\nimport { useEffect, useState } from 'react';\nimport { GLOBALS_UPDATED } from '@storybook/core-events';\n\nexport const useGlobals = (story: PreparedStory, context: DocsContextProps): [Globals] => {\n  const storyContext = context.getStoryContext(story);\n\n  const [globals, setGlobals] = useState(storyContext.globals);\n  useEffect(() => {\n    const onGlobalsUpdated = (changed: { globals: Globals }) => {\n      setGlobals(changed.globals);\n    };\n    context.channel.on(GLOBALS_UPDATED, onGlobalsUpdated);\n    return () => context.channel.off(GLOBALS_UPDATED, onGlobalsUpdated);\n  }, [context.channel]);\n\n  return [globals];\n};\n","import { useCallback, useEffect, useState } from 'react';\nimport type { Args, DocsContextProps, PreparedStory } from '@storybook/types';\nimport { STORY_ARGS_UPDATED, UPDATE_STORY_ARGS, RESET_STORY_ARGS } from '@storybook/core-events';\n\nexport const useArgs = (\n  story: PreparedStory,\n  context: DocsContextProps\n): [Args, (args: Args) => void, (argNames?: string[]) => void] => {\n  const result = useArgsIfDefined(story, context);\n  if (!result) throw new Error('No result when story was defined');\n  return result;\n};\n\nexport const useArgsIfDefined = (\n  story: PreparedStory | void,\n  context: DocsContextProps\n): [Args, (args: Args) => void, (argNames?: string[]) => void] | void => {\n  const storyContext = story ? context.getStoryContext(story) : { args: {} };\n  const { id: storyId } = story || { id: 'none' };\n\n  const [args, setArgs] = useState(storyContext.args);\n  useEffect(() => {\n    const onArgsUpdated = (changed: { storyId: string; args: Args }) => {\n      if (changed.storyId === storyId) {\n        setArgs(changed.args);\n      }\n    };\n    context.channel.on(STORY_ARGS_UPDATED, onArgsUpdated);\n    return () => context.channel.off(STORY_ARGS_UPDATED, onArgsUpdated);\n  }, [storyId, context.channel]);\n  const updateArgs = useCallback(\n    (updatedArgs: any) => context.channel.emit(UPDATE_STORY_ARGS, { storyId, updatedArgs }),\n    [storyId, context.channel]\n  );\n  const resetArgs = useCallback(\n    (argNames?: string[]) => context.channel.emit(RESET_STORY_ARGS, { storyId, argNames }),\n    [storyId, context.channel]\n  );\n  return story && [args, updateArgs, resetArgs];\n};\n","/* eslint-disable react/destructuring-assignment */\nimport type { Renderer, Parameters, StrictArgTypes } from '@storybook/csf';\nimport type { ModuleExports } from '@storybook/types';\nimport type { FC } from 'react';\nimport React, { useContext } from 'react';\nimport { filterArgTypes } from '@storybook/preview-api';\nimport type { PropDescriptor } from '@storybook/preview-api';\nimport type { ArgTypesExtractor } from '@storybook/docs-tools';\n\nimport { mapValues } from 'lodash';\nimport type { SortType } from '../components';\nimport { ArgsTable as PureArgsTable, ArgsTableError, TabbedArgsTable } from '../components';\nimport { DocsContext } from './DocsContext';\nimport { useGlobals } from './useGlobals';\nimport { useArgs } from './useArgs';\nimport { getComponentName } from './utils';\n\ntype ControlsParameters = {\n  include?: PropDescriptor;\n  exclude?: PropDescriptor;\n  sort?: SortType;\n};\n\ntype ControlsProps = ControlsParameters & {\n  of?: Renderer['component'] | ModuleExports;\n};\n\nfunction extractComponentArgTypes(\n  component: Renderer['component'],\n  parameters: Parameters\n): StrictArgTypes {\n  const { extractArgTypes }: { extractArgTypes: ArgTypesExtractor } = parameters.docs || {};\n  if (!extractArgTypes) {\n    throw new Error(ArgsTableError.ARGS_UNSUPPORTED);\n  }\n  return extractArgTypes(component);\n}\n\nexport const Controls: FC<ControlsProps> = (props) => {\n  const { of } = props;\n  if ('of' in props && of === undefined) {\n    throw new Error('Unexpected `of={undefined}`, did you mistype a CSF file reference?');\n  }\n\n  const context = useContext(DocsContext);\n  const { story } = context.resolveOf(of || 'story', ['story']);\n  const { parameters, argTypes, component, subcomponents } = story;\n  const controlsParameters = parameters.docs?.controls || ({} as ControlsParameters);\n\n  const include = props.include ?? controlsParameters.include;\n  const exclude = props.exclude ?? controlsParameters.exclude;\n  const sort = props.sort ?? controlsParameters.sort;\n\n  const [args, updateArgs, resetArgs] = useArgs(story, context);\n  const [globals] = useGlobals(story, context);\n\n  const filteredArgTypes = filterArgTypes(argTypes, include, exclude);\n\n  const hasSubcomponents = Boolean(subcomponents) && Object.keys(subcomponents).length > 0;\n\n  if (!hasSubcomponents) {\n    return (\n      <PureArgsTable\n        rows={filteredArgTypes}\n        sort={sort}\n        args={args}\n        globals={globals}\n        updateArgs={updateArgs}\n        resetArgs={resetArgs}\n      />\n    );\n  }\n\n  const mainComponentName = getComponentName(component);\n  const subcomponentTabs = mapValues(subcomponents, (comp) => ({\n    rows: filterArgTypes(extractComponentArgTypes(comp, parameters), include, exclude),\n    sort,\n  }));\n  const tabs = {\n    [mainComponentName]: { rows: filteredArgTypes, sort },\n    ...subcomponentTabs,\n  };\n  return (\n    <TabbedArgsTable\n      tabs={tabs}\n      sort={sort}\n      args={args}\n      globals={globals}\n      updateArgs={updateArgs}\n      resetArgs={resetArgs}\n    />\n  );\n};\n"],"names":["GLOBALS_UPDATED","useGlobals","story","context","storyContext","globals","setGlobals","useState","useEffect","onGlobalsUpdated","changed","STORY_ARGS_UPDATED","UPDATE_STORY_ARGS","RESET_STORY_ARGS","useArgs","result","useArgsIfDefined","storyId","args","setArgs","onArgsUpdated","updateArgs","useCallback","updatedArgs","resetArgs","argNames","filterArgTypes","extractComponentArgTypes","component","parameters","extractArgTypes","ArgsTableError","Controls","props","of","useContext","DocsContext","argTypes","subcomponents","controlsParameters","_a","include","exclude","sort","filteredArgTypes","React","PureArgsTable","mainComponentName","getComponentName","subcomponentTabs","mapValues","comp","tabs","TabbedArgsTable"],"mappings":"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"}