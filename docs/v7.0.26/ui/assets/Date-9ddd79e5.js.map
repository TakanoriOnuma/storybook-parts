{"version":3,"file":"Date-9ddd79e5.js","sources":["../../ui/blocks/src/controls/Date.tsx"],"sourcesContent":["import type { FC, ChangeEvent, RefObject } from 'react';\nimport React, { useState, useRef, useEffect } from 'react';\nimport { styled } from '@storybook/theming';\nimport { Form } from '@storybook/components';\n\nimport type { ControlProps, DateValue, DateConfig } from './types';\nimport { getControlId } from './helpers';\n\nexport const parseDate = (value: string) => {\n  const [year, month, day] = value.split('-');\n  const result = new Date();\n  result.setFullYear(parseInt(year, 10), parseInt(month, 10) - 1, parseInt(day, 10));\n  return result;\n};\n\nexport const parseTime = (value: string) => {\n  const [hours, minutes] = value.split(':');\n  const result = new Date();\n  result.setHours(parseInt(hours, 10));\n  result.setMinutes(parseInt(minutes, 10));\n  return result;\n};\n\nexport const formatDate = (value: Date | number) => {\n  const date = new Date(value);\n  const year = `000${date.getFullYear()}`.slice(-4);\n  const month = `0${date.getMonth() + 1}`.slice(-2);\n  const day = `0${date.getDate()}`.slice(-2);\n  return `${year}-${month}-${day}`;\n};\n\nexport const formatTime = (value: Date | number) => {\n  const date = new Date(value);\n  const hours = `0${date.getHours()}`.slice(-2);\n  const minutes = `0${date.getMinutes()}`.slice(-2);\n  return `${hours}:${minutes}`;\n};\n\nconst FlexSpaced = styled.div(({ theme }) => ({\n  flex: 1,\n  display: 'flex',\n\n  input: {\n    marginLeft: 10,\n    flex: 1,\n    height: 32, // hardcode height bc Chromium bug https://bugs.chromium.org/p/chromium/issues/detail?id=417606\n\n    '&::-webkit-calendar-picker-indicator': {\n      opacity: 0.5,\n      height: 12,\n      filter: theme.base === 'light' ? undefined : 'invert(1)',\n    },\n  },\n  'input:first-of-type': {\n    marginLeft: 0,\n    flexGrow: 4,\n  },\n  'input:last-of-type': {\n    flexGrow: 3,\n  },\n}));\n\nexport type DateProps = ControlProps<DateValue> & DateConfig;\nexport const DateControl: FC<DateProps> = ({ name, value, onChange, onFocus, onBlur }) => {\n  const [valid, setValid] = useState(true);\n  const dateRef = useRef<HTMLInputElement>();\n  const timeRef = useRef<HTMLInputElement>();\n  useEffect(() => {\n    if (valid !== false) {\n      if (dateRef && dateRef.current) {\n        dateRef.current.value = formatDate(value);\n      }\n      if (timeRef && timeRef.current) {\n        timeRef.current.value = formatTime(value);\n      }\n    }\n  }, [value]);\n\n  const onDateChange = (e: ChangeEvent<HTMLInputElement>) => {\n    const parsed = parseDate(e.target.value);\n    const result = new Date(value);\n    result.setFullYear(parsed.getFullYear(), parsed.getMonth(), parsed.getDate());\n    const time = result.getTime();\n    if (time) onChange(time);\n    setValid(!!time);\n  };\n\n  const onTimeChange = (e: ChangeEvent<HTMLInputElement>) => {\n    const parsed = parseTime(e.target.value);\n    const result = new Date(value);\n    result.setHours(parsed.getHours());\n    result.setMinutes(parsed.getMinutes());\n    const time = result.getTime();\n    if (time) onChange(time);\n    setValid(!!time);\n  };\n\n  const controlId = getControlId(name);\n\n  return (\n    <FlexSpaced>\n      <Form.Input\n        type=\"date\"\n        max=\"9999-12-31\" // I do this because of a rendering bug in chrome\n        ref={dateRef as RefObject<HTMLInputElement>}\n        id={`${controlId}-date`}\n        name={`${controlId}-date`}\n        onChange={onDateChange}\n        {...{ onFocus, onBlur }}\n      />\n      <Form.Input\n        type=\"time\"\n        id={`${controlId}-time`}\n        name={`${controlId}-time`}\n        ref={timeRef as RefObject<HTMLInputElement>}\n        onChange={onTimeChange}\n        {...{ onFocus, onBlur }}\n      />\n      {!valid ? <div>invalid</div> : null}\n    </FlexSpaced>\n  );\n};\n"],"names":["parseDate","value","year","month","day","result","parseTime","hours","minutes","formatDate","date","formatTime","FlexSpaced","styled","theme","DateControl","name","onChange","onFocus","onBlur","valid","setValid","useState","dateRef","useRef","timeRef","useEffect","onDateChange","e","parsed","time","onTimeChange","controlId","getControlId","jsxs","jsx","Form"],"mappings":"uNAQO,MAAAA,EAAAC,GAAA,CACL,KAAA,CAAAC,EAAAC,EAAAC,CAAA,EAAAH,EAAA,MAAA,GAAA,EACAI,EAAA,IAAA,KACA,OAAAA,EAAA,YAAA,SAAAH,EAAA,EAAA,EAAA,SAAAC,EAAA,EAAA,EAAA,EAAA,SAAAC,EAAA,EAAA,CAAA,EACAC,CACF,EAEOC,EAAAL,GAAA,CACL,KAAA,CAAAM,EAAAC,CAAA,EAAAP,EAAA,MAAA,GAAA,EACAI,EAAA,IAAA,KACA,OAAAA,EAAA,SAAA,SAAAE,EAAA,EAAA,CAAA,EACAF,EAAA,WAAA,SAAAG,EAAA,EAAA,CAAA,EACAH,CACF,EAEOI,EAAAR,GAAA,CACL,MAAAS,EAAA,IAAA,KAAAT,CAAA,EACAC,EAAA,MAAAQ,EAAA,YAAA,IAAA,MAAA,EAAA,EACAP,EAAA,IAAAO,EAAA,SAAA,EAAA,IAAA,MAAA,EAAA,EACAN,EAAA,IAAAM,EAAA,QAAA,IAAA,MAAA,EAAA,EACA,MAAA,GAAAR,KAAAC,KAAAC,GACF,EAEOO,EAAAV,GAAA,CACL,MAAAS,EAAA,IAAA,KAAAT,CAAA,EACAM,EAAA,IAAAG,EAAA,SAAA,IAAA,MAAA,EAAA,EACAF,EAAA,IAAAE,EAAA,WAAA,IAAA,MAAA,EAAA,EACA,MAAA,GAAAH,KAAAC,GACF,EAEAI,EAAAC,EAAA,IAAA,CAAA,CAAA,MAAAC,CAAA,KAAA,CAA8C,KAAA,EACtC,QAAA,OACG,MAAA,CAEF,WAAA,GACO,KAAA,EACN,OAAA,GACE,uCAAA,CAEgC,QAAA,GAC7B,OAAA,GACD,OAAAA,EAAA,OAAA,QAAA,OAAA,WACqC,CAC/C,EACF,sBAAA,CACuB,WAAA,EACT,SAAA,CACF,EACZ,qBAAA,CACsB,SAAA,CACV,CAEd,EAAA,EAGOC,EAAA,CAAA,CAAA,KAAAC,EAAA,MAAAf,EAAA,SAAAgB,EAAA,QAAAC,EAAA,OAAAC,KAAA,CACL,KAAA,CAAAC,EAAAC,CAAA,EAAAC,EAAA,SAAA,EAAA,EACAC,EAAAC,EAAAA,SACAC,EAAAD,EAAAA,SACAE,EAAAA,UAAA,IAAA,CACEN,IAAA,KACEG,GAAAA,EAAA,UACEA,EAAA,QAAA,MAAAd,EAAAR,CAAA,GAEFwB,GAAAA,EAAA,UACEA,EAAA,QAAA,MAAAd,EAAAV,CAAA,GAEJ,EAAA,CAAAA,CAAA,CAAA,EAGF,MAAA0B,EAAAC,GAAA,CACE,MAAAC,EAAA7B,EAAA4B,EAAA,OAAA,KAAA,EACAvB,EAAA,IAAA,KAAAJ,CAAA,EACAI,EAAA,YAAAwB,EAAA,YAAA,EAAAA,EAAA,WAAAA,EAAA,QAAA,CAAA,EACA,MAAAC,EAAAzB,EAAA,UACAyB,GAAUb,EAAAa,CAAA,EACVT,EAAA,CAAA,CAAAS,CAAA,CAAe,EAGjBC,EAAAH,GAAA,CACE,MAAAC,EAAAvB,EAAAsB,EAAA,OAAA,KAAA,EACAvB,EAAA,IAAA,KAAAJ,CAAA,EACAI,EAAA,SAAAwB,EAAA,SAAA,CAAA,EACAxB,EAAA,WAAAwB,EAAA,WAAA,CAAA,EACA,MAAAC,EAAAzB,EAAA,UACAyB,GAAUb,EAAAa,CAAA,EACVT,EAAA,CAAA,CAAAS,CAAA,CAAe,EAGjBE,EAAAC,EAAAjB,CAAA,EAEA,OAAAkB,EAAAtB,EAAA,CAAA,SAAA,CAEIuB,EAAAC,EAAA,MAAM,CAAL,KAAA,OACM,IAAA,aACD,IAAAb,EACC,GAAA,GAAAS,SACE,KAAA,GAAAA,SACE,SAAAL,EACC,QAAAT,EAAA,OAAAC,CACY,CAAA,EACxBgB,EACAC,EAAA,MAAM,CAAL,KAAA,OACM,GAAA,GAAAJ,SACE,KAAA,GAAAA,SACE,IAAAP,EACJ,SAAAM,EACK,QAAAb,EAAA,OAAAC,CACY,CAAA,EACxBC,EAAA,KAAAe,EAAA,MAAA,CAAA,SAAA,SAAA,CAAA,CAC+B,CAAA,CAAA,CAGrC"}