{"version":3,"file":"Story-c31830b5.js","sources":["../../ui/blocks/src/components/ZoomContext.tsx","../../ui/blocks/src/components/IFrame.tsx","../../ui/blocks/src/components/Story.tsx"],"sourcesContent":["import type { Context } from 'react';\nimport { createContext } from 'react';\n\nexport const ZoomContext: Context<{ scale: number }> = createContext({\n  scale: 1,\n});\n","import React, { Component } from 'react';\nimport { global } from '@storybook/global';\n\nconst { window: globalWindow } = global;\n\ninterface IFrameProps {\n  id: string;\n  key?: string;\n  title: string;\n  src: string;\n  allowFullScreen: boolean;\n  scale: number;\n  style?: any;\n}\n\ninterface BodyStyle {\n  width: string;\n  height: string;\n  transform: string;\n  transformOrigin: string;\n}\n\nexport class IFrame extends Component<IFrameProps> {\n  iframe: any = null;\n\n  componentDidMount() {\n    const { id } = this.props;\n    this.iframe = globalWindow.document.getElementById(id);\n  }\n\n  shouldComponentUpdate(nextProps: IFrameProps) {\n    const { scale } = nextProps;\n    // eslint-disable-next-line react/destructuring-assignment\n    if (scale !== this.props.scale) {\n      this.setIframeBodyStyle({\n        width: `${scale * 100}%`,\n        height: `${scale * 100}%`,\n        transform: `scale(${1 / scale})`,\n        transformOrigin: 'top left',\n      });\n    }\n    return false;\n  }\n\n  setIframeBodyStyle(style: BodyStyle) {\n    return Object.assign(this.iframe.contentDocument.body.style, style);\n  }\n\n  render() {\n    const { id, title, src, allowFullScreen, scale, ...rest } = this.props;\n    return (\n      <iframe\n        id={id}\n        title={title}\n        src={src}\n        {...(allowFullScreen ? { allow: 'fullscreen' } : {})}\n        loading=\"lazy\"\n        {...rest}\n      />\n    );\n  }\n}\n","import { global } from '@storybook/global';\nimport type { FunctionComponent } from 'react';\nimport React, { useRef, useEffect, useState } from 'react';\nimport type { DocsContextProps, PreparedStory } from '@storybook/types';\nimport { Loader, getStoryHref, ErrorFormatter } from '@storybook/components';\nimport { IFrame } from './IFrame';\nimport { ZoomContext } from './ZoomContext';\n\nconst { PREVIEW_URL } = global;\nconst BASE_URL = PREVIEW_URL || 'iframe.html';\n\ninterface CommonProps {\n  story: PreparedStory;\n  inline: boolean;\n  primary: boolean;\n}\n\ninterface InlineStoryProps extends CommonProps {\n  inline: true;\n  height?: string;\n  autoplay: boolean;\n  forceInitialArgs: boolean;\n  renderStoryToElement: DocsContextProps['renderStoryToElement'];\n}\n\ninterface IFrameStoryProps extends CommonProps {\n  inline: false;\n  height: string;\n}\n\nexport type StoryProps = InlineStoryProps | IFrameStoryProps;\n\nexport const storyBlockIdFromId = ({ story, primary }: StoryProps) =>\n  `story--${story.id}${primary ? '--primary' : ''}`;\n\nconst InlineStory: FunctionComponent<InlineStoryProps> = (props) => {\n  const storyRef = useRef();\n  const [showLoader, setShowLoader] = useState(true);\n  const [error, setError] = useState<Error>();\n\n  const { story, height, autoplay, forceInitialArgs, renderStoryToElement } = props;\n\n  useEffect(() => {\n    if (!(story && storyRef.current)) {\n      return () => {};\n    }\n    const element = storyRef.current as HTMLElement;\n    const cleanup = renderStoryToElement(\n      story,\n      element,\n      {\n        showMain: () => {},\n        showError: ({ title, description }: { title: string; description: string }) =>\n          setError(new Error(`${title} - ${description}`)),\n        showException: (err: Error) => setError(err),\n      },\n      { autoplay, forceInitialArgs }\n    );\n    setShowLoader(false);\n    return () => {\n      // It seems like you are supposed to unmount components outside of `useEffect`:\n      //   https://github.com/facebook/react/issues/25675#issuecomment-1363957941\n      Promise.resolve().then(() => cleanup());\n    };\n  }, [autoplay, renderStoryToElement, story]);\n\n  if (error) {\n    return (\n      <pre>\n        <ErrorFormatter error={error} />\n      </pre>\n    );\n  }\n\n  return (\n    <>\n      {height ? (\n        <style>{`#${storyBlockIdFromId(\n          props\n        )} { min-height: ${height}; transform: translateZ(0); overflow: auto }`}</style>\n      ) : null}\n      {showLoader && <StorySkeleton />}\n      <div ref={storyRef} id={`${storyBlockIdFromId(props)}-inner`} data-name={story.name} />\n    </>\n  );\n};\n\nconst IFrameStory: FunctionComponent<IFrameStoryProps> = ({ story, height = '500px' }) => (\n  <div style={{ width: '100%', height }}>\n    <ZoomContext.Consumer>\n      {({ scale }) => {\n        return (\n          <IFrame\n            key=\"iframe\"\n            id={`iframe--${story.id}`}\n            title={story.name}\n            src={getStoryHref(BASE_URL, story.id, { viewMode: 'story' })}\n            allowFullScreen\n            scale={scale}\n            style={{\n              width: '100%',\n              height: '100%',\n              border: '0 none',\n            }}\n          />\n        );\n      }}\n    </ZoomContext.Consumer>\n  </div>\n);\n\n/**\n * A story element, either rendered inline or in an iframe,\n * with configurable height.\n */\nconst Story: FunctionComponent<StoryProps> = (props) => {\n  const { inline } = props;\n\n  return (\n    <div id={storyBlockIdFromId(props)} className=\"sb-story sb-unstyled\" data-story-block=\"true\">\n      {inline ? (\n        <InlineStory {...(props as InlineStoryProps)} />\n      ) : (\n        <IFrameStory {...(props as IFrameStoryProps)} />\n      )}\n    </div>\n  );\n};\n\nconst StorySkeleton = () => <Loader />;\n\nexport { Story, StorySkeleton };\n"],"names":["ZoomContext","createContext","global","globalWindow","IFrame","Component","id","nextProps","scale","style","title","src","allowFullScreen","rest","React","PREVIEW_URL","BASE_URL","storyBlockIdFromId","story","primary","InlineStory","props","storyRef","useRef","showLoader","setShowLoader","useState","error","setError","height","autoplay","forceInitialArgs","renderStoryToElement","useEffect","element","cleanup","description","err","ErrorFormatter","StorySkeleton","IFrameStory","getStoryHref","Story","inline","Loader"],"mappings":"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"}